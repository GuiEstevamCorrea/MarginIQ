Documenta√ß√£o T√©cnica ‚Äì M√≥dulo de IA

Projeto: Sistema Inteligente de Aprova√ß√£o de Descontos

1. Papel da IA no Produto

A IA atua como motor de apoio √† decis√£o, respons√°vel por:

Recomendar desconto ideal

Calcular score de risco da negocia√ß√£o

Explicar a recomenda√ß√£o (explicabilidade)

Aprender com decis√µes humanas e resultado real

‚ö†Ô∏è A IA n√£o decide sozinha por padr√£o
Ela opera dentro de guardrails definidos pelo neg√≥cio.

2. Arquitetura da IA (Hexagonal)

A IA √© um adapter externo, acessado via port.

Application (Use Case)
   ‚îî‚îÄ‚îÄ IDiscountIntelligencePort
           ‚îî‚îÄ‚îÄ DiscountIAAdapter
                   ‚îú‚îÄ‚îÄ Feature Store
                   ‚îú‚îÄ‚îÄ Model
                   ‚îî‚îÄ‚îÄ Explanation Engine

Princ√≠pios

IA nunca acessa diretamente o banco transacional

Dados entram por DTOs

Fallback sempre dispon√≠vel (regras fixas)

3. Feature Store (Base de Aprendizado)
3.1 Objetivo

Centralizar dados normalizados e hist√≥ricos para:

treinamento

infer√™ncia

auditoria

N√£o usar tabelas transacionais diretamente.

3.2 Entidade: FeatureNegotiation

Cada linha representa uma negocia√ß√£o hist√≥rica.

Campos principais
Campo	Tipo	Observa√ß√£o
negotiation_id	UUID	Refer√™ncia
company_id	UUID	Isolamento por tenant
client_id	UUID	
product_category	string	Melhor que SKU no in√≠cio
deal_value	decimal	Valor total
discount_percent	decimal	% concedido
margin_estimated	decimal	No momento da decis√£o
decision	enum	approved / rejected / auto
approved_by	enum	human / ia
risk_score	int	0‚Äì100
deal_result	enum	won / lost / unknown
created_at	datetime	
3.3 Features Derivadas (calculadas)

Essas n√£o v√™m do banco, s√£o calculadas no adapter:

Feature	Descri√ß√£o
avg_discount_client	M√©dia hist√≥rica do cliente
avg_discount_segment	M√©dia do segmento
win_rate_client	Taxa de fechamento
discount_vs_avg	Desvio do desconto
margin_vs_avg	Desvio da margem
seller_discount_pattern	Tend√™ncia do vendedor

Essas features s√£o versionadas.

3.4 Persist√™ncia

Banco separado ou schema separado

Nunca alterar hist√≥rico (append-only)

Pode usar:

PostgreSQL

BigQuery (futuro)

Feature flags para evolu√ß√£o

4. Modelo Inicial (MVP)
4.1 Estrat√©gia

‚ùå Nada de deep learning no in√≠cio
‚úÖ Modelo h√≠brido: regras + estat√≠stica

Motivo:

Pouco dado inicial

Mais explic√°vel

Mais confi√°vel para CFO / gestor

4.2 Tipo de Modelo
Fase 1 ‚Äì Estat√≠stico

Regress√£o simples ou heur√≠stica ponderada

Clusteriza√ß√£o leve por cliente/segmento

Exemplo de score:

score = 
  w1 * desvio_desconto +
  w2 * desvio_margem +
  w3 * hist√≥rico_cliente +
  w4 * padr√£o_vendedor


Pesos configur√°veis por empresa.

4.3 Output do Modelo
{
  "recommendedDiscount": 12.5,
  "expectedMargin": 28.3,
  "riskScore": 34,
  "confidence": 0.81
}

5. Explicabilidade (Obrigat√≥rio)

A explica√ß√£o n√£o vem do modelo, vem de uma camada de interpreta√ß√£o.

5.1 Engine de Explica√ß√£o

Baseada em regras simples:

Exemplos:

‚ÄúDesconto est√° 5% acima da m√©dia hist√≥rica deste cliente‚Äù

‚ÄúMargem final est√° dentro do padr√£o do segmento‚Äù

‚ÄúVendedor costuma conceder descontos acima da m√©dia‚Äù

5.2 Estrutura
{
  "summary": "Desconto recomendado com baixo risco",
  "reasons": [
    "Cliente aceita descontos m√©dios de 10‚Äì15%",
    "Margem permanece acima do m√≠nimo",
    "Hist√≥rico de fechamento positivo"
  ]
}

6. Casos de Uso da IA
IA-UC-01 ‚Äì Recomendar Desconto

Input

{
  "companyId": "...",
  "clientId": "...",
  "products": [...],
  "dealValue": 100000,
  "requestedDiscount": 18
}


Processo

Carregar features hist√≥ricas

Calcular features derivadas

Executar modelo

Gerar explica√ß√£o

IA-UC-02 ‚Äì Calcular Score de Risco

Score entre 0‚Äì100

Faixa	Interpreta√ß√£o
0‚Äì30	Baixo risco
31‚Äì60	M√©dio risco
61‚Äì100	Alto risco
IA-UC-03 ‚Äì Aprender com Feedback

Disparado quando:

Gestor aprova/reprova

Neg√≥cio fecha ou √© perdido

Processo:

Persistir novo registro no feature store

Marcar para reprocessamento

Ajustar pesos periodicamente

7. Ciclo de Treinamento
7.1 Frequ√™ncia

MVP: batch di√°rio ou semanal

Nunca em tempo real

7.2 Versionamento

Vers√£o do modelo registrada

Cada decis√£o guarda:

model_version

feature_version

8. Governan√ßa e Seguran√ßa
8.1 Controles

Ligar/desligar IA por empresa

Definir n√≠vel de autonomia

Limitar % de autoaprova√ß√£o

8.2 Auditoria

Cada decis√£o da IA grava:

Input

Output

Explica√ß√£o

Vers√£o do modelo

9. Fallback (Regra de Ouro)

Se IA:

falhar

ultrapassar timeout

estiver desativada

‚û°Ô∏è sistema usa motor de regras fixas.

10. Roadmap Evolutivo da IA
Fase 1 (MVP)

Estat√≠stica + regras

Explicabilidade simples

Fase 2

Gradient Boosting

Segmenta√ß√£o autom√°tica

Fase 3

Aprendizado por resultado financeiro

Simula√ß√µes de margem

üî• Resumo para o Dev

IA ‚â† dom√≠nio

Feature store √© ativo estrat√©gico

Comece simples

Explique sempre

Governe tudo